<!DOCTYPE html>
<html>
<head>

	<title>chapter2-4</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.12.0/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	
	<style type="text/css">
		/**{
			margin: 0;
			padding: 0;
		}*/
		line{
			shape-rendering: crispEdges;
			stroke:#000;
		}
		path.domain {
			fill: none;
			stroke: black;
		}

	</style>
</head>
<body>

	<svg width="1000" height="200" style="border:1px lightgray solid"></svg>
	
	<script>
		d3.json('./stats.json', makeStatsChart)

		function growthFormula(b, g, n) {
			var result = b + ((n-1)*(g)*(0.685 + (0.0175*n)));
			return result;
		}

		function makeStatsChart(incomingData){
			//챠트 초기값 설정
			var svg = d3.select('svg'),
				width = +svg.attr('width'),
				height = +svg.attr('height');
			var margin = {
				top: 20,
				right: 50,
				bottom: 20,
				left: 50
			}

			var targetData = [];
			var targetName = 'Jax'
			var targetStats = 'attackdamage';
			var targetStatsGrowth = 'attackdamageperlevel';
			var target = incomingData.data[targetName]

			for(var i = 1; i < 19; i++) {
				var temp = growthFormula(
	 				+target.stats[targetStats]
					, +target.stats[targetStatsGrowth]
					, i)
				targetData.push(temp);
			}


			//챠트 축 설정
			var x = d3.scaleLinear()
					  .domain([0, 18])
					  .range([margin.left, width-margin.right])
			var y = d3.scaleLinear()
					  .domain([0, Math.max(...targetData)*1.2])
					  .range([(height)-margin.top, margin.bottom])

			var xAxis = d3.axisBottom().scale(x).ticks(5).tickSize(height-(margin.top+margin.bottom))
			var yAxis = d3.axisLeft().scale(y).ticks(5).tickSize(width-(margin.right+margin.left))
			d3.select('svg').append('g').attr('id', 'xG')
			  .attr("transform", "translate("+ 0 + "," + margin.bottom + ")")
			  .call(xAxis)			
			d3.select('svg').append('g').attr('id', 'yG')
			  .attr("transform", "translate(" + (width-margin.right) + "," + 0 + ")")
			  .call(yAxis)

			

			// 각 데이터 그리는 부분
			d3.select('svg').selectAll('circle')
			  .data(targetData).enter()
			  .append('circle')
			  .attr('r', 0)
			  .attr('cx', function(d,i) {return x(i+1)})
			  .attr('cy', function(d,i) {return y(d)} )
			  .attr('fill', 'lightgray')
			  .transition()
			  .delay(function(d, i) {return i*100})
			  .duration(200)
			  .attr('r', 20)
			  .transition()
			  .delay(function(d, i) {return i*100})
			  .duration(200)
			  .attr('r', 5)
			  

			//선그래프 그리는 부분
			var statsLine = d3.line()
							  .x(function(d,i) {return x(i+1)})
							  .y(function(d,i) {return y(d)})

			d3.select('svg')
			  .append('path')
			  .attr('d', statsLine(targetData))
			  .attr('fill', 'none')
			  .attr('stroke', 'lightblue')
			  .attr('stroke-width', 0)
			  .transition()
			  .delay(function(d, i) {return i*10000})
			  .duration(10000)
			  .attr('stroke-width', 2)
		}

		
	</script>
</body>
</html>